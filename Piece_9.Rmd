---
title: "Working with ChatGPT"
author: "Benjamin Egan"
output: html_document
---
#### Created 4/7/25

#### Note - Some of the code chunks I provide will run loops of code for up to 10,000 attempts. For speed, the code provided by ChatGPT will not run. If you would like for it to run, you need to change eval to TRUE.


```{r libaries, include = FALSE}
library(tidyverse) 
```

In the process of creating Portfolio 8, I came across some trouble getting the results I wanted. As a reminder, the problem was to create simulated data for a 2(Yes/No Sugar) x 2(Yes/No Caffeine) ANOVA, with perceived distance as the dependent variable. In an ideal world, I wanted there to be a main effect of caffeine (caffeine decreased perceived distance), no main effect of sugar, and an interaction, such that the combination of both sugar and caffeine exponentially decreased perceived distance.

Here is a crude graph depicting what I was looking to create:

![](ideal_results.jpeg) <br/>

Ultimately I got close, but the green line had a positive slope, indicating adding sugar actually increased perceived distance. I decided to ask ChatGPT if it had any suggestions. I am going to include my questions asked, it's response/suggested code, my evaluation of the code, etc.


## The inital ask

I began by providing chatGPT the context, my problem, and the R markdown file for Portfolio 8 (https://github.com/eganba23/Portfolio_8). Here is is my question:

#### I am trying to create data for a lab. It is a 2x2 design, with  two IVs, sugar and caffeine, and the dv is distance. I am attaching the R file I have used. I want there to be a significant main effect of caffeine and interaction, but no main effect of sugar. I need for going from no sugar to sugar to always decrease, but in a non-significant way. 

ChatGPT responded with a brief summary of my ask and defined out the terms. It suggested this mean structure and the effects:

```{r suggested structure, message = FALSE, echo = FALSE}
library(kableExtra)

suggestion_dataframe <- data.frame(
                  Sugar = c("No", "Yes", "No", "Yes"),
                  Caffeine = c("No", "No", "Yes","Yes"),
                  Mean_Distance = c(50, 48, 60, 56),
                  Effect = c(" ", "(small drop)", "(big jump)", "(smaller jump)"))

kable(suggestion_dataframe, row.names = F) %>%
     column_spec (1:4, border_left = T, border_right = T) %>% 
     kable_styling()

```

It suggested the setup provided a main effect of caffeine, a slight drop with sugar in both levels, and an interaction. I knew it didn't acknowledge that I wanted sugar to be non-significant, so I replied:

#### Sorry. I need the main effect of caffeine to be adding caffeine decrease distance scores. The interaction would mean that the combination of sugar and caffeine reduced scores the most


It then understood that I did not want a main effect for sugar. It suggested these means:
```{r updated suggested structure, echo = FALSE}
suggestion_dataframe <- data.frame(
                  Sugar = c("No", "Yes", "No", "Yes"),
                  Caffeine = c("No", "No", "Yes","Yes"),
                  Mean_Distance = c(50, 48, 45, 40),
                  Effect = c(" ", "(small drop)", "(big drop from 50)", "(even bigger drop from 48)"))

kable(suggestion_dataframe, row.names = F) %>%
     column_spec (1:4, border_left = T, border_right = T) %>% 
     kable_styling()

```


It suggested the setup provided a strong negative main effect of caffeine, sugar slightly lowers scores in both caffeine conditions (so consistent, but subtle), and an interaction.


I said wonderful, and I wanted code to reflect this.

## The first code

```{r first chat code, message=FALSE, eval = FALSE warning=FALSE}

set.seed(123)  # for reproducibility
library(tidyverse)
library(ggplot2)
library(emmeans)

# Number of participants per condition
n_per_cell <- 30

# Define means to create the desired effects
means <- tibble(
  sugar = rep(c("No", "Yes"), each = 2),
  caffeine = rep(c("No", "Yes"), times = 2),
  mean_distance = c(50, 45, 48, 40),  # NoS/NoC, NoS/YesC, YesS/NoC, YesS/YesC
  sd = 5
)

# Generate the dataset
sim_data <- means %>%
  rowwise() %>%
  mutate(
    distance = list(rnorm(n_per_cell, mean = mean_distance, sd = sd)),
    participant = list(1:n_per_cell)
  ) %>%
  unnest(c(distance, participant)) %>%
  mutate(
    sugar = factor(sugar, levels = c("No", "Yes")),
    caffeine = factor(caffeine, levels = c("No", "Yes"))
  )

# Fit ANOVA model
model <- aov(distance ~ sugar * caffeine, data = sim_data)
summary(model)

# Plot the interaction
ggplot(sim_data, aes(x = caffeine, y = distance, fill = sugar)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(.9)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = .2,
               position = position_dodge(.9)) +
  labs(title = "Interaction of Sugar and Caffeine on Distance",
       y = "Distance", x = "Caffeine") +
  theme_minimal()
```



```{r simulate-2x2-best-match-safe, message=FALSE, eval = FALSE, warning=FALSE}

set.seed(123)
library(tidyverse)
library(ggplot2)
library(emmeans)

n_per_cell <- 30
max_tries <- 10000

means <- tibble(
  sugar = rep(c("No", "Yes"), each = 2),
  caffeine = rep(c("No", "Yes"), times = 2),
  mean_distance = c(50, 45, 49.5, 43.5),
  sd = 6
)

success <- FALSE
attempt <- 1

best_fit <- list(
  p_sugar = NA,
  p_caffeine = NA,
  p_interaction = NA,
  distance = Inf,
  model = NULL,
  data = NULL
)

score_fit <- function(p_sugar, p_caff, p_int) {
  score <- 0
  if (!is.na(p_sugar)) score <- score + abs(p_sugar - 0.5)
  if (!is.na(p_caff))  score <- score + abs(p_caff - 0.01)
  if (!is.na(p_int))   score <- score + abs(p_int - 0.01)
  return(score)
}

while (!success && attempt <= max_tries) {
  sim_data <- means %>%
    rowwise() %>%
    mutate(
      distance = list(rnorm(n_per_cell, mean = mean_distance, sd = sd)),
      participant = list(1:n_per_cell)
    ) %>%
    unnest(c(distance, participant)) %>%
    mutate(
      sugar = factor(sugar, levels = c("No", "Yes")),
      caffeine = factor(caffeine, levels = c("No", "Yes"))
    )

  model <- tryCatch(
    aov(distance ~ sugar * caffeine, data = sim_data),
    error = function(e) NULL
  )

  if (!is.null(model)) {
    results <- summary(model)[[1]]
    if (all(c("sugar", "caffeine", "sugar:caffeine") %in% rownames(results))) {
      p_sugar <- results["sugar", "Pr(>F)"]
      p_caffeine <- results["caffeine", "Pr(>F)"]
      p_interaction <- results["sugar:caffeine", "Pr(>F)"]

      if (!any(is.na(c(p_sugar, p_caffeine, p_interaction)))) {
        this_score <- score_fit(p_sugar, p_caffeine, p_interaction)
        if (this_score < best_fit$distance) {
          best_fit <- list(
            p_sugar = p_sugar,
            p_caffeine = p_caffeine,
            p_interaction = p_interaction,
            distance = this_score,
            model = model,
            data = sim_data
          )
        }

        if (p_sugar > 0.05 && p_caffeine < 0.05 && p_interaction < 0.05) {
          success <- TRUE
          cat("✅ Success on attempt", attempt, "\n")
        }
      }

      if (attempt %% 100 == 0) {
        cat("Attempt", attempt, 
            "| p_sugar:", round(p_sugar, 4),
            "| p_caff:", round(p_caffeine, 4),
            "| p_int:", round(p_interaction, 4), "\n")
      }
    }
  }

  attempt <- attempt + 1
}

if (!success) {
  cat("❌ No perfect fit found after", max_tries, "tries.\n")
  if (is.null(best_fit$model) || is.null(best_fit$data)) {
    cat("⚠️ Could not generate even one usable dataset with valid ANOVA output.\n")
  } else {
    cat("Closest match:\n")
    cat("  p_sugar      =", round(best_fit$p_sugar, 4), "\n")
    cat("  p_caffeine   =", round(best_fit$p_caffeine, 4), "\n")
    cat("  p_interaction=", round(best_fit$p_interaction, 4), "\n")
    model <- best_fit$model
    sim_data <- best_fit$data

    # Show summary and plot
    print(summary(model))
    ggplot(sim_data, aes(x = caffeine, y = distance, fill = sugar)) +
      stat_summary(fun = mean, geom = "bar", position = position_dodge(.9)) +
      stat_summary(fun.data = mean_se, geom = "errorbar", width = .2,
                   position = position_dodge(.9)) +
      labs(title = "Best Attempt: Sugar x Caffeine",
           y = "Distance", x = "Caffeine") +
      theme_minimal()
  }
} else {
  # If success, show and plot
  print(summary(model))
  ggplot(sim_data, aes(x = caffeine, y = distance, fill = sugar)) +
    stat_summary(fun = mean, geom = "bar", position = position_dodge(.9)) +
    stat_summary(fun.data = mean_se, geom = "errorbar", width = .2,
                 position = position_dodge(.9)) +
    labs(title = "Successful Simulation: Sugar x Caffeine",
         y = "Distance", x = "Caffeine") +
    theme_minimal()
}

```

didn't work, implementing suggestions

```{r simulate-2x2-optimized, message=FALSE, eval = FALSE, warning=FALSE}

set.seed(123)
library(tidyverse)
library(ggplot2)
library(emmeans)

n_per_cell <- 50      # Larger N
max_tries <- 10000
sd_val <- 8           # Increased SD

means <- tibble(
  sugar = rep(c("No", "Yes"), each = 2),
  caffeine = rep(c("No", "Yes"), times = 2),
  mean_distance = c(50, 45, 49.5, 43.5),  # sugar effect small
  sd = sd_val
)

success <- FALSE
attempt <- 1

best_fit <- list(
  p_sugar = NA,
  p_caffeine = NA,
  p_interaction = NA,
  distance = Inf,
  model = NULL,
  data = NULL
)

score_fit <- function(p_sugar, p_caff, p_int) {
  score <- 0
  if (!is.na(p_sugar)) score <- score + abs(p_sugar - 0.5)
  if (!is.na(p_caff))  score <- score + abs(p_caff - 0.01)
  if (!is.na(p_int))   score <- score + abs(p_int - 0.01)
  return(score)
}

while (!success && attempt <= max_tries) {
  sim_data <- means %>%
    rowwise() %>%
    mutate(
      distance = list(rnorm(n_per_cell, mean = mean_distance, sd = sd)),
      participant = list(1:n_per_cell)
    ) %>%
    unnest(c(distance, participant)) %>%
    mutate(
      sugar = factor(sugar, levels = c("No", "Yes")),
      caffeine = factor(caffeine, levels = c("No", "Yes"))
    )

  model <- tryCatch(
    aov(distance ~ sugar * caffeine, data = sim_data),
    error = function(e) NULL
  )

  if (!is.null(model)) {
    results <- summary(model)[[1]]
    if (all(c("sugar", "caffeine", "sugar:caffeine") %in% rownames(results))) {
      p_sugar <- results["sugar", "Pr(>F)"]
      p_caffeine <- results["caffeine", "Pr(>F)"]
      p_interaction <- results["sugar:caffeine", "Pr(>F)"]

      if (!any(is.na(c(p_sugar, p_caffeine, p_interaction)))) {
        this_score <- score_fit(p_sugar, p_caffeine, p_interaction)
        if (this_score < best_fit$distance) {
          best_fit <- list(
            p_sugar = p_sugar,
            p_caffeine = p_caffeine,
            p_interaction = p_interaction,
            distance = this_score,
            model = model,
            data = sim_data
          )
        }

        if (p_sugar > 0.05 && p_caffeine < 0.05 && p_interaction < 0.05) {
          success <- TRUE
          cat("✅ Success on attempt", attempt, "\n")
        }
      }

      if (attempt %% 100 == 0) {
        cat("Attempt", attempt, 
            "| p_sugar:", round(p_sugar, 4),
            "| p_caff:", round(p_caffeine, 4),
            "| p_int:", round(p_interaction, 4), "\n")
      }
    }
  }

  attempt <- attempt + 1
}

if (!success) {
  cat("❌ No perfect fit found after", max_tries, "tries.\n")
  if (is.null(best_fit$model) || is.null(best_fit$data)) {
    cat("⚠️ Could not generate even one usable dataset with valid ANOVA output.\n")
  } else {
    cat("Closest match:\n")
    cat("  p_sugar      =", round(best_fit$p_sugar, 4), "\n")
    cat("  p_caffeine   =", round(best_fit$p_caffeine, 4), "\n")
    cat("  p_interaction=", round(best_fit$p_interaction, 4), "\n")
    model <- best_fit$model
    sim_data <- best_fit$data

    # Show summary and plot
    print(summary(model))
    ggplot(sim_data, aes(x = caffeine, y = distance, fill = sugar)) +
      stat_summary(fun = mean, geom = "bar", position = position_dodge(.9)) +
      stat_summary(fun.data = mean_se, geom = "errorbar", width = .2,
                   position = position_dodge(.9)) +
      labs(title = "Best Attempt: Sugar x Caffeine",
           y = "Distance", x = "Caffeine") +
      theme_minimal()
  }
} else {
  # If success, show and plot
  print(summary(model))
  ggplot(sim_data, aes(x = caffeine, y = distance, fill = sugar)) +
    stat_summary(fun = mean, geom = "bar", position = position_dodge(.9)) +
    stat_summary(fun.data = mean_se, geom = "errorbar", width = .2,
                 position = position_dodge(.9)) +
    labs(title = "Successful Simulation: Sugar x Caffeine",
         y = "Distance", x = "Caffeine") +
    theme_minimal()
}
```


```{r simulate-2x2-random-seed-best, message=FALSE, eval = FALSE, warning=FALSE}

library(tidyverse)
library(ggplot2)
library(emmeans)

n_per_cell <- 50
max_tries <- 10000
sd_val <- 8

means <- tibble(
  sugar = rep(c("No", "Yes"), each = 2),
  caffeine = rep(c("No", "Yes"), times = 2),
  mean_distance = c(50, 45, 49.5, 43.5),  # Sugar effect is small
  sd = sd_val
)

success <- FALSE
attempt <- 1

best_fit <- list(
  p_sugar = NA,
  p_caffeine = NA,
  p_interaction = NA,
  distance = Inf,
  model = NULL,
  data = NULL,
  seed = NA
)

score_fit <- function(p_sugar, p_caff, p_int) {
  score <- 0
  if (!is.na(p_sugar)) score <- score + abs(p_sugar - 0.5)
  if (!is.na(p_caff))  score <- score + abs(p_caff - 0.01)
  if (!is.na(p_int))   score <- score + abs(p_int - 0.01)
  return(score)
}

while (!success && attempt <= max_tries) {
  current_seed <- sample(1:1e6, 1)
  set.seed(current_seed)

  sim_data <- means %>%
    rowwise() %>%
    mutate(
      distance = list(rnorm(n_per_cell, mean = mean_distance, sd = sd)),
      participant = list(1:n_per_cell)
    ) %>%
    unnest(c(distance, participant)) %>%
    mutate(
      sugar = factor(sugar, levels = c("No", "Yes")),
      caffeine = factor(caffeine, levels = c("No", "Yes"))
    )

  model <- tryCatch(
    aov(distance ~ sugar * caffeine, data = sim_data),
    error = function(e) NULL
  )

  if (!is.null(model)) {
    results <- summary(model)[[1]]
    if (all(c("sugar", "caffeine", "sugar:caffeine") %in% rownames(results))) {
      p_sugar <- results["sugar", "Pr(>F)"]
      p_caffeine <- results["caffeine", "Pr(>F)"]
      p_interaction <- results["sugar:caffeine", "Pr(>F)"]

      if (!any(is.na(c(p_sugar, p_caffeine, p_interaction)))) {
        this_score <- score_fit(p_sugar, p_caffeine, p_interaction)
        if (this_score < best_fit$distance) {
          best_fit <- list(
            p_sugar = p_sugar,
            p_caffeine = p_caffeine,
            p_interaction = p_interaction,
            distance = this_score,
            model = model,
            data = sim_data,
            seed = current_seed
          )
        }

        if (p_sugar > 0.05 && p_caffeine < 0.05 && p_interaction < 0.05) {
          success <- TRUE
          cat("🎯 Successful attempt using seed:", current_seed, "\n")
        }
      }

      if (attempt %% 100 == 0) {
        cat("Attempt", attempt, 
            "| p_sugar:", round(p_sugar, 4),
            "| p_caff:", round(p_caffeine, 4),
            "| p_int:", round(p_interaction, 4), "\n")
      }
    }
  }

  attempt <- attempt + 1
}

if (!success) {
  cat("❌ No perfect fit found after", max_tries, "tries.\n")
  if (is.null(best_fit$model) || is.null(best_fit$data)) {
    cat("⚠️ Could not generate even one usable dataset with valid ANOVA output.\n")
  } else {
    cat("Closest match (not meeting full criteria):\n")
    cat("  Seed         =", best_fit$seed, "\n")
    cat("  p_sugar      =", round(best_fit$p_sugar, 4), "\n")
    cat("  p_caffeine   =", round(best_fit$p_caffeine, 4), "\n")
    cat("  p_interaction=", round(best_fit$p_interaction, 4), "\n")
    model <- best_fit$model
    sim_data <- best_fit$data

    print(summary(model))
    ggplot(sim_data, aes(x = caffeine, y = distance, fill = sugar)) +
      stat_summary(fun = mean, geom = "bar", position = position_dodge(.9)) +
      stat_summary(fun.data = mean_se, geom = "errorbar", width = .2,
                   position = position_dodge(.9)) +
      labs(title = paste("Best Attempt (Seed:", best_fit$seed, ")"),
           y = "Distance", x = "Caffeine") +
      theme_minimal()
  }
} else {
  # If success, show and plot
  cat("✅ You can reproduce this dataset using: set.seed(", best_fit$seed, ")\n")
  print(summary(best_fit$model))
  ggplot(best_fit$data, aes(x = caffeine, y = distance, fill = sugar)) +
    stat_summary(fun = mean, geom = "bar", position = position_dodge(.9)) +
    stat_summary(fun.data = mean_se, geom = "errorbar", width = .2,
                 position = position_dodge(.9)) +
    labs(title = paste("Successful Simulation (Seed:", best_fit$seed, ")"),
         y = "Distance", x = "Caffeine") +
    theme_minimal()
}
```


```{r simulate-2x2-variable-means, message=FALSE, eval = FALSE, warning=FALSE}

library(tidyverse)
library(ggplot2)
library(emmeans)

n_per_cell <- 50
max_tries <- 10000
sd_val <- 15  # You can increase this if needed for more realism

success <- FALSE
attempt <- 1

best_fit <- list(
  p_sugar = NA,
  p_caffeine = NA,
  p_interaction = NA,
  distance = Inf,
  model = NULL,
  data = NULL,
  seed = NA
)

score_fit <- function(p_sugar, p_caff, p_int) {
  score <- 0
  if (!is.na(p_sugar)) score <- score + abs(p_sugar - 0.5)
  if (!is.na(p_caff))  score <- score + abs(p_caff - 0.01)
  if (!is.na(p_int))   score <- score + abs(p_int - 0.01)
  return(score)
}

while (!success && attempt <= max_tries) {
  current_seed <- sample(1:1e6, 1)
  set.seed(current_seed)

  # Generate fluctuating means between 100 and 500
  base <- runif(1, 300, 500)

  mean_distance <- c(
    base,                          # No sugar, No caffeine
    base - 20,                     # No sugar, Yes caffeine
    base - runif(1, 0, 3),         # Yes sugar, No caffeine (small drop)
    base - 20 - runif(1, 5, 10)    # Yes sugar, Yes caffeine (interaction)
  )

  means <- tibble(
    sugar = rep(c("No", "Yes"), each = 2),
    caffeine = rep(c("No", "Yes"), times = 2),
    mean_distance = mean_distance,
    sd = sd_val
  )

  sim_data <- means %>%
    rowwise() %>%
    mutate(
      distance = list(rnorm(n_per_cell, mean = mean_distance, sd = sd)),
      participant = list(1:n_per_cell)
    ) %>%
    unnest(c(distance, participant)) %>%
    mutate(
      sugar = factor(sugar, levels = c("No", "Yes")),
      caffeine = factor(caffeine, levels = c("No", "Yes"))
    )

  model <- tryCatch(
    aov(distance ~ sugar * caffeine, data = sim_data),
    error = function(e) NULL
  )

  if (!is.null(model)) {
    results <- summary(model)[[1]]
    if (all(c("sugar", "caffeine", "sugar:caffeine") %in% rownames(results))) {
      p_sugar <- results["sugar", "Pr(>F)"]
      p_caffeine <- results["caffeine", "Pr(>F)"]
      p_interaction <- results["sugar:caffeine", "Pr(>F)"]

      if (!any(is.na(c(p_sugar, p_caffeine, p_interaction)))) {
        this_score <- score_fit(p_sugar, p_caffeine, p_interaction)
        if (this_score < best_fit$distance) {
          best_fit <- list(
            p_sugar = p_sugar,
            p_caffeine = p_caffeine,
            p_interaction = p_interaction,
            distance = this_score,
            model = model,
            data = sim_data,
            seed = current_seed
          )
        }

        if (p_sugar > 0.05 && p_caffeine < 0.05 && p_interaction < 0.05) {
          success <- TRUE
          cat("🎯 Successful attempt using seed:", current_seed, "\n")
        }
      }

      if (attempt %% 100 == 0) {
        cat("Attempt", attempt, 
            "| p_sugar:", round(p_sugar, 4),
            "| p_caff:", round(p_caffeine, 4),
            "| p_int:", round(p_interaction, 4), "\n")
      }
    }
  }

  attempt <- attempt + 1
}

if (!success) {
  cat("❌ No perfect fit found after", max_tries, "tries.\n")
  if (is.null(best_fit$model) || is.null(best_fit$data)) {
    cat("⚠️ Could not generate even one usable dataset with valid ANOVA output.\n")
  } else {
    cat("Closest match (not meeting full criteria):\n")
    cat("  Seed         =", best_fit$seed, "\n")
    cat("  p_sugar      =", round(best_fit$p_sugar, 4), "\n")
    cat("  p_caffeine   =", round(best_fit$p_caffeine, 4), "\n")
    cat("  p_interaction=", round(best_fit$p_interaction, 4), "\n")
    model <- best_fit$model
    sim_data <- best_fit$data

    print(summary(model))
    ggplot(sim_data, aes(x = caffeine, y = distance, fill = sugar)) +
      stat_summary(fun = mean, geom = "bar", position = position_dodge(.9)) +
      stat_summary(fun.data = mean_se, geom = "errorbar", width = .2,
                   position = position_dodge(.9)) +
      labs(title = paste("Best Attempt (Seed:", best_fit$seed, ")"),
           y = "Distance", x = "Caffeine") +
      theme_minimal()
  }
} else {
  cat("✅ You can reproduce this dataset using: set.seed(", best_fit$seed, ")\n")
  print(summary(best_fit$model))
  ggplot(best_fit$data, aes(x = caffeine, y = distance, fill = sugar)) +
    stat_summary(fun = mean, geom = "bar", position = position_dodge(.9)) +
    stat_summary(fun.data = mean_se, geom = "errorbar", width = .2,
                 position = position_dodge(.9)) +
    labs(title = paste("Successful Simulation (Seed:", best_fit$seed, ")"),
         y = "Distance", x = "Caffeine") +
    theme_minimal()
}
```
